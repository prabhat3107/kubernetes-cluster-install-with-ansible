
- name: Deploy metallb menifest
  ansible.builtin.shell:
    cmd: kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.14.9/config/manifests/metallb-native.yaml
  register: metallb_deploy

- name: metallb L2 range allocation
  kubernetes.core.k8s:
    src: ../metallb/L2-range-allocation.yaml
    state: present
  when: metallb_deploy is succeeded

- name: Download ingress-nginx
  ansible.builtin.shell:
    cmd: kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.12.1/deploy/static/provider/cloud/deploy.yaml

